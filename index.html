<!DOCTYPE html>
<head>
<title>Recovery International Mobile App</title>
<!-- For iPhone 4 with high-resolution Retina display: -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/recovery/favicon.png" />
<!-- For first-generation iPad: -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/recovery/favicon.png" />
<!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: --> <link rel="apple-touch-icon-precomposed" href="/recovery/favicon.png" /> <!-- For nokia devices: -->
<link rel="shortcut icon" href="favicon.png" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
<style type="text/css">
body {
    overflow: scroll;
    font-family: Arial, Helvetica, sans-serif;
    font-size: 16px;
    margin: 0;
    padding: 0;
}

a {
    color: #5177D0;
    text-decoration: underline;
}

p {
    margin: 13px;
}

form {
    margin: 13px;
}

h1 {
    font-size: 20px;
}

h1, h2, h3, h4, h5, h6 {
    color: #21446C;
    margin: 13px;
}

li {
    margin: 13px;
}

.logo {
    margin-top: 5px;
    margin-left: 1%;
    width: 50%;
}

.menu_btn {
    margin-top: 5px;
    margin-left: 2%;
    width: 10%;
}

.logo_div {
    position: absolute;
<?php
if ($_GET["app"])
{
    if ($_GET["app"] == "ios")
    {
        print "top: 14px;\n";
    }
    else
    {
        print "top: 0\n";
    }
}
else
{
    print "top: 0\n";
}
?>
    left: 0;
    width: 100%;
}

.logo_bg {
<?php
if ($_GET["app"])
{
    if ($_GET["app"] == "ios")
    {
        print "padding-top: 14px;\n";
    }
}
?>
}

#ios_header {
    position: fixed;
    top: 0;
    /*margin-top: -14px;*/
    width: 100%;
    height: 14px;
    /*height: 44px;*/
    color: #007aff;
    border-bottom: solid 1px #7299a9;
    background-color: #f3f6f6;
<?php
if ($_GET["app"])
{
    if ($_GET["app"] != "ios")
    {
        print "display: none;\n";
    }
}
?>
}
</style>
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3840794-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
</head>
<body>
    <div class="logo_div">
        <div style="display: inline;">
            <img src="images/logo.png" class="logo">
        </div>
    </div>
    <div class="logo_bg">
        <img src="images/header-bg8.jpg" style="width: 100%;">
    </div>

<?php
    if ($_GET['show'] == "results")
    {
        echo "<h1><a href=\"#\" onclick=\"document.getElementById('search_form').style.display = 'block';\">Search Again</a></h1>\n";
        echo "<div id=\"search_form\" style=\"display: none;\">\n";
    }
    else
    {
        echo "<div id=\"search_form\" style=\"display: block;\">\n";
    }
?>
        <p>Search by Zip Code</p>
<?php
if ($_GET["app"])
{
    print "        <form method=\"post\" class=\"meeting\" name=\"zip\" action=\"meeting.php?show=results&app=" . $_GET["app"] . "\">";
}
else
{
    print "        <form method=\"post\" class=\"meeting\" name=\"zip\" action=\"meeting.php?show=results\">";
}
?>
<!--        <form method="post" class="meeting" name="zip" action="meeting.php?show=results">-->
            <table class="general form" cellspacing="1">
        		<tbody>
                    <tr><th>Your postal code</th><td><input type="text" class="txt" name="zip" value="" onkeydown="return clickButton(event, 'zipbtn');" /></td></tr>
                    <tr><th>Search radius</th><td><select name="radius"><option value="25">25 miles</option><option value="50">50 miles</option><option value="100">100 miles</option></select></td></tr>
                    <tr><th colspan="2"><input type="submit" name="cmd" id="zipbtn" value="Find a meeting" class="btn" /></th></tr>
                </tbody>
		    </table>
        </form>

        <hr />

        <p>Search by State (includes Puerto Rico)</p>
<?php
if ($_GET["app"])
{
    print "        <form method=\"post\" class=\"meeting\" action=\"meeting.php?show=results&app=" . $_GET["app"] . "\">";
}
else
{
    print "        <form method=\"post\" class=\"meeting\" action=\"meeting.php?show=results\">";
}
?>
<!--        <form method="post" class="meeting" action="meeting.php?show=results">-->
            <table class="general form" cellspacing="1">
                <tbody>
                    <tr><th>State</th><td><select name="state" onkeydown="return clickButton(event, 'statebtn');"><option value="">Select a state</option>
<option value="Alabama">Alabama</option>
<option value="Arizona">Arizona</option>
<option value="California">California</option>
<option value="Colorado">Colorado</option>
<option value="Connecticut">Connecticut</option>
<option value="District of Columbia">District of Columbia</option>
<option value="Florida">Florida</option>
<option value="Georgia">Georgia</option>
<option value="Idaho">Idaho</option>
<option value="Illinois">Illinois</option>
<option value="Indiana">Indiana</option>
<option value="Iowa">Iowa</option>
<option value="Kansas">Kansas</option>
<option value="Kentucky">Kentucky</option>
<option value="Louisiana">Louisiana</option>
<option value="Maine">Maine</option>
<option value="Maryland">Maryland</option>
<option value="Massachusetts">Massachusetts</option>
<option value="Michigan">Michigan</option>
<option value="Minnesota">Minnesota</option>
<option value="Missouri">Missouri</option>
<option value="Montana">Montana</option>
<option value="Nebraska">Nebraska</option>
<option value="Nevada">Nevada</option>
<option value="New Hampshire">New Hampshire</option>
<option value="New Jersey">New Jersey</option>
<option value="New Mexico">New Mexico</option>
<option value="New York">New York</option>
<option value="North Carolina">North Carolina</option>
<option value="Ohio">Ohio</option>
<option value="Oklahoma">Oklahoma</option>
<option value="Oregon">Oregon</option>
<option value="Pennsylvania">Pennsylvania</option>
<option value="Puerto Rico">Puerto Rico</option>
<option value="Rhode Island">Rhode Island</option>
<option value="Texas">Texas</option>
<option value="Utah">Utah</option>
<option value="Vermont">Vermont</option>
<option value="Virginia">Virginia</option>
<option value="Washington">Washington</option>
<option value="West Virginia">West Virginia</option>
<option value="Wisconsin">Wisconsin</option>
                        </select></td></tr>
                    <tr><th colspan="2"><input type="submit" name="cmd" id="statebtn" value="List meetings" class="btn" /></th></tr>
                </tbody>
            </table>
        </form>

<hr />
</div>
<div id="ios_header">
</div>
<p>
<?php

if ($_POST["zip"])
{
$url="http://www.lowselfhelpsystems.org/meetings/find-a-meeting.asp";
$data="zip=" . $_POST["zip"] . "&radius=" . $_POST["radius"] . "&cmd=Find+a+meeting";

$ch=curl_init();
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
$reply=curl_exec($ch);
curl_close($ch);

$splitter = "<table class=\"general meeting\"";
$pieces = explode($splitter, $reply);
$reply = $pieces[1];
//$reply = $splitter . $reply;

$splitter ="</table>";
$pieces = explode($splitter, $reply);
$reply = $pieces[0];
//$reply = $reply . $splitter;

$reply = str_replace("<br>","<br />",$reply);
$reply = str_replace("</br>","",$reply);

$reply = str_replace("cellspacing=\"1\">","",$reply);
$reply = str_replace("<th>","",$reply);
$reply = str_replace("</th>","<br />",$reply);
$reply = str_replace("<tr>","",$reply);
$reply = str_replace("</tr>","<br />",$reply);
$reply = str_replace("<td>","",$reply);
$reply = str_replace("</td>","<br />",$reply);
$reply = str_replace("Distance","Results",$reply);
$reply = str_replace("Location<br />","",$reply);
$reply = str_replace("Details<br />","",$reply);
$reply = str_replace("miles","miles recoveryappsplit",$reply);
$reply = str_replace("(","",$reply);
$reply = str_replace(") ","-",$reply);
$new_reply = "";

preg_match_all('/\b[(]?\d{3}\s*[)]?[-]?\s*\d{3}\s*-\s*\d{4}\b/',$reply,$phone);

$pieces = preg_split("/\b[(]?\d{3}\s*[)]?[-]?\s*\d{3}\s*-\s*\d{4}\b/", $reply);

for ($i = 0; $i < count($pieces); ++$i)
{
    $new_reply = $new_reply . $pieces[$i] . "<a href=tel:\"" . str_replace("-","",$phone[0][$i]) . "\">" . $phone[0][$i] . "</a>";
}

$reply = $new_reply;

$pieces = split("recoveryappsplit", $reply);

    for ($i = 0; $i < count($pieces); ++$i)
    {
        $piecesj = split("<br />", $pieces[$i]);
        for ($j = 0; $j < count($piecesj); ++$j)
        {
            if ($i != 0)
            {
                if ($j == 0)
                {

                }
                elseif ($j == 2)
                {

                }
                elseif ($j == 3)
                {
                $new_replyapp = $new_replyapp . "<a href=\"https://maps.apple.com/?daddr=" . str_replace(" ","+",$piecesj[$j-1]) . "+" . str_replace(" ","+",$piecesj[$j]) . "\">" . $piecesj[$j-1] . "<br />" . $piecesj[$j] . "</a><br />";
                }
                else
                {
                $new_replyapp = $new_replyapp . $piecesj[$j] . "<br />";
                }
            }
            else
            {
                $new_replyapp = $new_replyapp . $piecesj[$j] . "<br />";
            }
        }
    }

$reply = $new_replyapp;
print $reply;
}



if ($_POST["state"])
{
$url="http://www.lowselfhelpsystems.org/meetings/meetings-per-city.asp";
$data="state=" . $_POST["state"] . "&cmd=List+meetings";

$ch=curl_init();
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
$reply=curl_exec($ch);
curl_close($ch);

$splitter = "<table class=\"general meeting\"";
$pieces = explode($splitter, $reply);
$reply = $pieces[1];

$splitter ="</table>";
$pieces = explode($splitter, $reply);
$reply = $pieces[0];

$reply = str_replace("</br>","",$reply);
$reply = str_replace("cellspacing=\"1\">","",$reply);
$reply = str_replace("<th>","",$reply);
$reply = str_replace("</th>","<br />",$reply);
$reply = str_replace("<tr>","",$reply);
$reply = str_replace("</tr>","<br />",$reply);
$reply = str_replace("<td>","",$reply);
$reply = str_replace("</td>","<br />",$reply);
$reply = str_replace("City","Results",$reply);
$reply = str_replace("Location<br />","",$reply);
$reply = str_replace("Details<br />","",$reply);
$reply = str_replace("(","",$reply);
$reply = str_replace(") ","-",$reply);
//$reply = preg_replace('<[a-z\.0-9]+|i', '', $reply);
$reply = strip_tags($reply,"<br><strong>");
$reply = str_replace("<br>View map","",$reply);
$reply = str_replace("<br>","<br />",$reply);
$new_reply = "";

preg_match_all('/\b[(]?\d{3}\s*[)]?[-]?\s*\d{3}\s*-\s*\d{4}\b/',$reply,$phone);

$pieces = preg_split("/\b[(]?\d{3}\s*[)]?[-]?\s*\d{3}\s*-\s*\d{4}\b/", $reply);

for ($i = 0; $i < count($pieces); ++$i)
{
    $new_reply = $new_reply . $pieces[$i] . "<a href=tel:\"" . str_replace("-","",$phone[0][$i]) . "\">" . $phone[0][$i] . "</a> recoveryappsplit";
}

$reply = $new_reply;

$pieces = split("recoveryappsplit", $reply);

    for ($i = 0; $i < count($pieces); ++$i)
    {
        $piecesj = split("<br />", $pieces[$i]);
        for ($j = 0; $j < count($piecesj); ++$j)
        {
            if ($i != 0)
            {
                if ($j == 0)
                {

                }
                elseif ($j == 4)
                {

                }
                elseif ($j == 5)
                {
                $new_replyapp = $new_replyapp . "<a href=\"http://maps.apple.com/?daddr=" . str_replace(" ","+",$piecesj[$j-1]) . "+" . str_replace(" ","+",$piecesj[$j]) . "\">" . $piecesj[$j-1] . "<br />" . $piecesj[$j] . "</a><br />";
                }
                else
                {
                $new_replyapp = $new_replyapp . $piecesj[$j] . "<br />";
                }
            }
            elseif ($i == 0)
            {
                if ($j == 4)
                {
                
                }
                elseif ($j == 5)
                {
                $new_replyapp = $new_replyapp . "<a href=\"http://maps.apple.com/?daddr=" . str_replace(" ","+",$piecesj[$j-1]) . "+" . str_replace(" ","+",$piecesj[$j]) . "\">" . $piecesj[$j-1] . "<br />" . $piecesj[$j] . "</a><br />";
                    //$new_replyapp = $new_replyapp . $piecesj[$j] . $j . "<br />";
                }
                else
                {
                    $new_replyapp = $new_replyapp . $piecesj[$j] . "<br />";
                }
            }
            else
            {
                $new_replyapp = $new_replyapp . $piecesj[$j] . $j . "<br />";
            }
        }
    }

$reply = $new_replyapp;
print $reply;
}



?>
</p>
</body>
</html>
